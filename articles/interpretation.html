<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interpretation tools • tabnet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Interpretation tools">
<meta property="og:description" content="tabnet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tabnet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/interpretation.html">Interpretation tools</a>
    </li>
    <li>
      <a href="../articles/tidymodels-interface.html">Fitting tabnet with tidymodels</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="interpretation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interpretation tools</h1>
            
      
      
      <div class="hidden name"><code>interpretation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tabnet</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</span>
<span class="co">#&gt; ✔ ggplot2 3.3.3     ✔ purrr   0.3.4</span>
<span class="co">#&gt; ✔ tibble  3.0.4     ✔ dplyr   1.0.2</span>
<span class="co">#&gt; ✔ tidyr   1.1.2     ✔ stringr 1.4.0</span>
<span class="co">#&gt; ✔ readr   1.4.0     ✔ forcats 0.5.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_manual_seed.html">torch_manual_seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>TabNet claims to be a interpretable model because the underlying neural network architecture uses feature selection masks that can help identifying which features were used in each step.</p>
<p>The paper also defines an aggregated measure that combines the masks of each step into a single measure.</p>
<p>Note that the selection of important features in the masks is done instance-wise, thus you can identify for each observation which were relevant features.</p>
<div id="experiments" class="section level2">
<h2 class="hasAnchor">
<a href="#experiments" class="anchor"></a>Experiments</h2>
<p>In order to show how to use the interpretation tools of tabnet we are going to make 2 experiments using synthetic datasets very similar to those that were used in the paper.</p>
<div id="datasets" class="section level3">
<h3 class="hasAnchor">
<a href="#datasets" class="anchor"></a>Datasets</h3>
<p>First, let’s define the functions that we will use to generate data:</p>
<ul>
<li><p><code>make_syn2</code> will generate a dataset with 10 columns, but only the 3-6 columns are used to calculate the <code>y</code> response vector. This is similar to <em>Syn2</em> in the paper.</p></li>
<li><p><code>make_syn4</code> will generate a dataset with 10 columns too. The response vector depends on the 10th columns: if the value is greater than 0, then we use the 1-2 columns to compute the logits, otherwise we use the 5-6 columns.</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logit_to_y</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">logits</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">logits</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">logits</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">make_random_x</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"V%02d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span>

<span class="va">make_syn2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">make_random_x</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="va">logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">logit_to_y</span><span class="op">(</span><span class="va">logits</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span>

<span class="va">make_syn4</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">make_random_x</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="va">logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
    <span class="va">x</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">x</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">logit_to_y</span><span class="op">(</span><span class="va">logits</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span></code></pre></div>
<p>Now let’s generate the datasets:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">syn2</span> <span class="op">&lt;-</span> <span class="fu">make_syn2</span><span class="op">(</span><span class="op">)</span>
<span class="va">syn4</span> <span class="op">&lt;-</span> <span class="fu">make_syn4</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="syn2" class="section level3">
<h3 class="hasAnchor">
<a href="#syn2" class="anchor"></a>Syn2</h3>
<p>Let’s fit a TabNet model to the syn2 dataset and than analyze the interpretation metrics.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_syn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabnet_fit.html">tabnet_fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">syn2</span>, epochs <span class="op">=</span> <span class="fl">10</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [Epoch 001] Loss: 0.820546</span>
<span class="co">#&gt; [Epoch 002] Loss: 0.533757</span>
<span class="co">#&gt; [Epoch 003] Loss: 0.443653</span>
<span class="co">#&gt; [Epoch 004] Loss: 0.373786</span>
<span class="co">#&gt; [Epoch 005] Loss: 0.301538</span>
<span class="co">#&gt; [Epoch 006] Loss: 0.233970</span>
<span class="co">#&gt; [Epoch 007] Loss: 0.204033</span>
<span class="co">#&gt; [Epoch 008] Loss: 0.178630</span>
<span class="co">#&gt; [Epoch 009] Loss: 0.155728</span>
<span class="co">#&gt; [Epoch 010] Loss: 0.147667</span></code></pre></div>
<p>In the feature importance plot when can see that as expected V03-V06 features are by far the most important ones.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">vip</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vip/man/vip.html">vip</a></span><span class="op">(</span><span class="va">fit_syn2</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-5-1.png" width="100%" height="300px"> Now let’s visualize the aggregated masks plot. In this figure we see each observation in the x axis and each variable in the y axis the colors represent the importance of the feature to predict the value for each observation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">ex_syn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabnet_explain.html">tabnet_explain</a></span><span class="op">(</span><span class="va">fit_syn2</span>, <span class="va">syn2</span><span class="op">)</span>

<span class="va">ex_syn2</span><span class="op">$</span><span class="va">M_explain</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>rowname <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">rowname</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"m_agg"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rowname</span>, y <span class="op">=</span> <span class="va">variable</span>, fill <span class="op">=</span> <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-6-1.png" width="100%" height="300px"> We can see that the region between the V03 and V06 concentrate most of the higher intensity colors and the other variables are close to 0. This is expected because those are the variables that we considered when building the dataset.</p>
<p>Next, we can visualize the attention masks for each step in the architecture.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ex_syn2</span><span class="op">$</span><span class="va">masks</span> <span class="op">%&gt;%</span> 
  <span class="fu">imap_dfr</span><span class="op">(</span><span class="op">~</span><span class="fu">mutate</span><span class="op">(</span>
    <span class="va">.x</span>, 
    step <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Step %d"</span>, <span class="va">.y</span><span class="op">)</span>,
    rowname <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rowname</span>, <span class="va">step</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"m_agg"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rowname</span>, y <span class="op">=</span> <span class="va">variable</span>, fill <span class="op">=</span> <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">step</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-7-1.png" width="100%" height="300px"> We see that the first step captures a lot of noise, but the other 2 steps focus specifically in the important features.</p>
</div>
</div>
<div id="syn-4" class="section level2">
<h2 class="hasAnchor">
<a href="#syn-4" class="anchor"></a>Syn 4</h2>
<p>Now let’s analyze the results for the Syn4 dataset. This dataset is a little more complicated for TabNet because there’s a strong interaction between the variables. Depending on V10, different variables are used to create the response variable and we expect to visualize this in the masks.</p>
<p>First we fit the model for 10 epochs.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_syn4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabnet_fit.html">tabnet_fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">syn4</span>, epochs <span class="op">=</span> <span class="fl">10</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [Epoch 001] Loss: 0.802401</span>
<span class="co">#&gt; [Epoch 002] Loss: 0.591248</span>
<span class="co">#&gt; [Epoch 003] Loss: 0.531086</span>
<span class="co">#&gt; [Epoch 004] Loss: 0.465337</span>
<span class="co">#&gt; [Epoch 005] Loss: 0.408927</span>
<span class="co">#&gt; [Epoch 006] Loss: 0.366301</span>
<span class="co">#&gt; [Epoch 007] Loss: 0.327295</span>
<span class="co">#&gt; [Epoch 008] Loss: 0.272445</span>
<span class="co">#&gt; [Epoch 009] Loss: 0.235137</span>
<span class="co">#&gt; [Epoch 010] Loss: 0.214474</span></code></pre></div>
<p>In the feature importance plot we have as expected, strong importance in V10, and the other features that are used conditionally - V01-V02 &amp; V05-V06.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">vip</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vip/man/vip.html">vip</a></span><span class="op">(</span><span class="va">fit_syn4</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-9-1.png" width="100%" height="300px"></p>
<p>Now let’s visualize the attention masks. Notice that we arranged the dataset by V10 so we can easily visualize the interaction effects.</p>
<p>We also trimmed the 99th percentile so the colors shows the importance even if there are strong outliers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ex_syn4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabnet_explain.html">tabnet_explain</a></span><span class="op">(</span><span class="va">fit_syn4</span>, <span class="fu">arrange</span><span class="op">(</span><span class="va">syn4</span>, <span class="va">V10</span><span class="op">)</span><span class="op">)</span>
<span class="va">q99</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.995</span><span class="op">)</span>

<span class="va">ex_syn4</span><span class="op">$</span><span class="va">M_explain</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>rowname <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">rowname</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"m_agg"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>m_agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">m_agg</span> <span class="op">&gt;</span> <span class="fu">q99</span><span class="op">(</span><span class="va">m_agg</span><span class="op">)</span>, <span class="fu">q99</span><span class="op">(</span><span class="va">m_agg</span><span class="op">)</span>, <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rowname</span>, y <span class="op">=</span> <span class="va">variable</span>, fill <span class="op">=</span> <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-10-1.png" width="100%" height="300px"> From the figure we see that V10 is important for all observations. We also see that for the first half of the dataset V05 and V06 is the most important feature, for the other half, V01 and V02 are the important ones.</p>
<p>We can also visualize the fast at each step in the architecture.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ex_syn4</span><span class="op">$</span><span class="va">masks</span> <span class="op">%&gt;%</span> 
  <span class="fu">imap_dfr</span><span class="op">(</span><span class="op">~</span><span class="fu">mutate</span><span class="op">(</span>
    <span class="va">.x</span>, 
    step <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Step %d"</span>, <span class="va">.y</span><span class="op">)</span>,
    rowname <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rowname</span>, <span class="va">step</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"m_agg"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">step</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>m_agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">m_agg</span> <span class="op">&gt;</span> <span class="fu">q99</span><span class="op">(</span><span class="va">m_agg</span><span class="op">)</span>, <span class="fu">q99</span><span class="op">(</span><span class="va">m_agg</span><span class="op">)</span>, <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rowname</span>, y <span class="op">=</span> <span class="va">variable</span>, fill <span class="op">=</span> <span class="va">m_agg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">step</span><span class="op">)</span></code></pre></div>
<p><img src="interpretation_files/figure-html/unnamed-chunk-11-1.png" width="100%" height="300px"></p>
<p>We see that Step 1 and 3 both focus on V10, but on different features depending on V10. Step 2 seems to have found some noise in V08, but also focus strongly on V01-V02 and V05-V06.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Falbel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
